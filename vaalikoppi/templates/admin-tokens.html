{% extends 'base.html' %}
{% load static %}

{% block body %}
  <div class="bg">
		<div class="navbar-fixed" id="top">
      <nav>
        <div class="nav-wrapper prodeko-blue">
          <div id="logo" class="center brand-logo"><img id="vaalikoppi-logo" src="{% static 'css/Vaalikoppi.png' %}" /></div>
          <div class="fixed-action-btn toolbar" id="deactivate-btn">
            <a class="transparent right">
              <i class="large material-icons">close</i>
            </a>
          </div>
        </div>
      </nav>
    </div>

    <div  class="container main-container">

    {% if not tokens %}
    <div class="card blue-grey lighten-5">
      <div class="card-content blue-grey-text text-lighten-1 center">
        <span class="card-title blue-grey-text text-lighten-1">Luo ensin koodit.</span>
      </div>
    </div>
    {% endif %}

		{% csrf_token %}
		<div class="card blue-grey lighten-5">
	     <div class="card-action center">
			      <button id="generate-tokens-button" class="btn waves-effect waves-light darken-1 white-text candidate bold-font" onclick="generateTokens(100)">Generoi 100 uutta koodia</button>
			 </div>
	  </div>

    {% if tokens %}
    <div class="card blue-grey lighten-5">
      <table class="highlight bordered">
        <thead>
          <tr>
              <th>Token type</th>
              <th>Token count</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Kaikki koodit</td>
            <td>{{ tokens|length }}</td>
          </tr>
          <tr>
            <td>Aktivoimattomat koodit</td>
            <td>{{ new_tokens }}</td>
          </tr>
          <tr>
            <td>Aktiiviset koodit</td>
            <td>{{ active_tokens }}</td>
          </tr>
          <tr>
            <td>Mitätöidyt koodit</td>
            <td>{{ invalid_tokens }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card blue-grey lighten-5">
      <div class="card-content blue-grey-text text-lighten-1">
        <span class="card-title blue-grey-text text-lighten-1">Koodit</span>
        <input type="text" id="searchInput" onkeyup="searchFunction()" placeholder="Etsi koodia..">
      </div>
      <table class="highlight bordered" id="searchTable">
        <thead>
          <tr>
            <th>Koodi</th>
            <th>Otettu käyttöön</th>
            <th>Mitätöity</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for usertoken in tokens %}
          <tr>
            <td>{{ usertoken.token }}</td>
            <td>{{ usertoken.activated }}</td>
            <td>{{ usertoken.invalidated }}</td>
            <td>
              {% if not usertoken.activated %}
              <button id="activate-token-button-{{ forloop.counter }}"
              class="btn waves-effect waves-light darken-1 white-text green candidate bold-font"
              onclick="activateToken('{{ usertoken.token }}',{{ forloop.counter }})">
              Aktivoi
              </button>
              {% else %}
              <button class="btn waves-effect waves-light darken-1 white-text grey candidate bold-font" disabled=True>Aktivoitu</button>
              {% endif %}
            </td>
            <td>
              {% if not usertoken.invalidated %}
              <button id="invalidate-token-button-{{ forloop.counter }}"
              class="btn waves-effect waves-light darken-1 white-text red candidate bold-font"
              onclick="invalidateToken('{{ usertoken.token }}',{{ forloop.counter }})">Mitätöi</button>
              {% else %}
              <button class="btn waves-effect waves-light darken-1 white-text grey candidate bold-font" disabled=True>Ei käytössä</button>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    </div>
    {% endif %}



		<div class="card blue-grey lighten-5">
			<div class="card-content blue-grey-text text-lighten-1 center">
	       <span class="card-title blue-grey-text text-lighten-1">Invalidoi koodi</span>
         <input type="text" id="invalidate-token-field" size="50">
	    </div>
	    <div class="card-action center">
				<button id="invalidate-token-button" class="btn waves-effect waves-light darken-1 white-text red candidate bold-font" onclick="invalidateToken()">Invalidoi</button>
			</div>
	  </div>
	</div>
</div>


    <!-- {% if not user.is_authenticated %} -->

		<!-- {% endif %} -->

		<!-- {% if user.is_authenticated %} -->

		<!-- {% endif %} -->

{% endblock %}
