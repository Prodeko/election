<!-- Avattu äänestys -->
{% if open_votings %}
{% for voting in open_votings %}

<!-- Siirtoäänivaalitapa -->
{% if voting.is_transferable %}
<div class="card blue-grey lighten-5">
    <div class="card-content grey-text center">
        <span class="card-title blue-grey-text text-darken-1 bold-font">{{ voting }}</span>
        {% if voting.voting_description %}<p>{{ voting.voting_description }}</p>{% endif %}
        <p>Valitse haluamasi määrä ehdokkaita järjestyksessä. Valitsemattomat ehdokkaat merkitään tyhjiksi ääniksi.</p>
    </div>
    <div class="card-action">
        {% if voting.candidates.all %}
        <div id="voting-form-{{ voting.id }}" class="voting-form-transferable" data-voting-max-votes="{{ voting.max_votes }}">
            {% csrf_token %}
            {% for candidate in voting.candidates.all %}
            <div style="display: flex; flex-direction: row;">
                <div class="voting-order blue darken-1" name="candidate" id="candidate-v-{{ voting.id }}-{{ candidate.id }}" value="{{ candidate.id }}">-</div>
                <label value="candidate-v-{{ voting.id }}-{{ candidate.id }}" class="transfer-vote-candidate waves-effect waves-turqoise blue-grey darken-2 btn-large wide-button hoverable">{{ candidate.candidate_name }}</label><br>
            </div>
            {% endfor %}
            <button onclick="voteTransferableElection({{ voting.id }})" style="margin-top: 20px;" class="btn waves-effect waves-light red darken-1 white-text wide-button bold-font">Äänestä</button>
            <button onclick="clear({{ voting.id }})" class="clear-vote btn waves-effect waves-light grey white-text wide-button bold-font">Tyhjennä</button>
        </div>
        {% endif %}
    </div>
</div>
    
<!-- Enemmistöäänivaalitapa -->
{% else %}
<div class="card blue-grey lighten-5">
    <div class="card-content grey-text center">
        <span class="card-title blue-grey-text text-darken-1 bold-font">{{ voting }}</span>
        {% if voting.voting_description %}<p>{{ voting.voting_description }}</p>{% endif %}
        <p>Ääniä käytettävissä {{ voting.max_votes }} kpl.</p>
        </div>
        <div class="card-action">
            {% if voting.candidates.all %}
            <div id="voting-form-{{ voting.id }}" class="voting-form" data-voting-max-votes="{{ voting.max_votes }}">
                {% csrf_token %}
                {% for candidate in voting.candidates.all %}
                <input type="{% if voting.max_votes > 1 %}checkbox{% else %}radio{% endif %}" name="candidate" id="candidate-v-{{ voting.id }}-{{ candidate.id }}" value="{{ candidate.id }}" onchange="checkboxClick({{ voting.id }}, {{ candidate.id }})">
                <label for="candidate-v-{{ voting.id }}-{{ candidate.id }}" class="waves-effect waves-red blue-grey darken-2 btn-large wide-button hoverable">{{ candidate.candidate_name }}</label><br>
                {% endfor %}
                <button onclick="vote({{ voting.id }})" class="btn waves-effect waves-light red darken-1 white-text wide-button bold-font">Äänestä</button>
            </div>
            {% endif %}
    </div>
</div>
{% endif %}
{% endfor %}
{% endif %}

<!-- Avaamaton äänestys -->
{% if closed_votings %}
{% for voting in closed_votings %}
<div class="card grey lighten-3">
    <div class="card-content blue-grey-text text-lighten-1 center">
        <span class="card-title blue-grey-text text-lighten-1">{{ voting }}</span>
        {% if voting.voting_description %}
        <p>{{ voting.voting_description }}</p>
        {% endif %}
    </div>
    <div class="card-action">
        {% if voting.candidates.all %}
        {% for candidate in voting.candidates.all %}
        <a class="disabled blue-grey lighten-1 btn-large wide-button">{{ candidate.candidate_name }}</a>
        {% endfor %}
        {% endif %}
    </div>
</div>
{% endfor %}
{% endif %}


<!-- Päättynyt äänestys -->
{% if ended_votings %}
{% for voting in ended_votings %}
{% if voting.is_transferable %}
<div class="transfer-election card prodeko-blue white-text center" onclick="expandResults(this)">
    <div class="card-title-container">
        <h3 class="card-title bold-font">{{ voting }}</h3>
        {% if voting.grouped_results|length > 1 %}
        <i class="expand-results material-icons">chevron_right</i>
        {% endif %}
    </div>
    <div class="results">
        {% for round in voting.grouped_results %}
        <div class="result">
            <div class="voting-round">
                <span class="round-number">{{ round.round }}.</span>
                kierros
            </div>
            <table class="result-table">
                {% for candidate in round.candidates %}
                <tr class="candidate {% if candidate.elected %} elected {% elif candidate.dropped %} dropped {% endif %}">
                    <td class="candidate-name">
                        {{ candidate.candidate_name }}
                        {% if candidate.dropped %}
                            (pudonnut)
                        {% elif candidate.elected %}
                            (valittu)
                        {% endif %}
                    </td>
                    <td>{{ candidate.vote_count }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card prodeko-blue white-text center">
    <div class="card-title-container">
        <h3 class="card-title bold-font">{{ voting }}</h3>
    </div>
    <div class="results">
        <table class="result-table">
            {% for candidate in voting.results %}
            <tr class="candidate {% if candidate.elected %} elected {% elif candidate.dropped %} dropped {% endif %}">
                <td class="candidate-name">
                    {{ candidate.candidate_name }}
                    {% if candidate.dropped %}
                        (pudonnut)
                    {% elif candidate.elected %}
                        (valittu)
                    {% endif %}
                </td>
                <td>{{ candidate.vote_count }}</td>
                <td>{{ candidate.vote_share }}&nbsp;%</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

{% endif %}
{% endfor %}
{% endif %}
